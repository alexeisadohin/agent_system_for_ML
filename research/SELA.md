# Tree-Search Enhanced LLM Agents (SELA): Детальное описание

##  Основные компоненты системы

### 1. **Insight Proposer**
- **Функция**: Генерирует стратегии для этапов ML-пайплайна (EDA, предобработка, feature engineering, обучение).  
- **Вход**: Описание задачи + метаданные датасета.  
- **Выход**: Пул инсайтов (например, "логарифмирование признаков", "использование Random Forest").  
- **Пример**: Для Feature Engineering может предложить 5+ методов (PCA, взаимодействия признаков и т.д.).

### 2. **Search Module (MCTS)**
- **Структура**: Пространство поиска представлено в виде дерева:  
  - **Узлы** = этапы пайплайна + конкретные инсайты.  
  - **Пути** = полные конфигурации экспериментов.  
- **Алгоритм**: Модифицированный **UCT-DP** (Upper Confidence Bound for Trees with Depth Preference):  
  $$
  \text{UCT-DP}(x) = \frac{v(x)}{n(x)} + \alpha_{\text{explore}} \sqrt{\frac{\ln n_{\text{visits}}(x_{\text{parent}})}{n(x)}}
  $$  
  где:  
  $$
  n(x) = 
  \begin{cases} 
  \alpha_{\text{unvisited}} & \text{если } n_{\text{visits}}(x) = 0 \\ 
  n_{\text{visits}}(x) & \text{иначе}.
  \end{cases}
  $$

### 3. **Experiment Executor**
- **Этапы**:  
  1. **Планирование**: Создает пошаговый план на основе выбранных инсайтов.  
  2. **Генерация кода**: Пишет исполняемый код для каждого этапа.  
  3. **Оценка**: Возвращает метрику (F1, RMSE) после выполнения эксперимента.

---

##  Процесс поиска с MCTS

1. **Selection (Выбор)**:  
   - Рекурсивный выбор узлов с максимизацией UCT-DP.  
   - Приоритет узлам на большей глубине (например, Model Training).

2. **Expansion (Расширение)**:  
   - Создание дочерних узлов для непосещенных ветвей.  
   *Пример*: Узел "Feature Engineering" → 5 дочерних узлов (логарифмирование, PCA и т.д.).

3. **Simulation (Симуляция)**:  
   - Запуск эксперимента для выбранного пути.  
   - **Пример пути**: [Feature Engineering → PCA, Model Training → XGBoost] → F1-score = 0.85.

4. **Backpropagation (Обратное распространение)**:  
   - Обновление значений `v(x)` и `n_visits(x)` вдоль пути.  
   - Узлы с высокими оценками получают приоритет в будущих итерациях.

---

##  Оптимизации

- **Кэширование кода**:  
  Повторное использование кода для общих этапов → снижение затрат на токены LLM.  
- **Адаптация к LLM**:  
  Поддержка DeepSeek, Claude, GPT-4o с разницей в NS < 5%.

---

##  Эксперименты и результаты

### Настройки
- **Датасеты**: 20 датасетов (13 классификация, 7 регрессия).  
- **Базовые методы**: AutoGluon, AutoSklearn, Data Interpreter, AIDE.  
- **Метрики**:  
  - **Normalized Score (NS)**: Нормализованная оценка (0–1).  
  - **Average Rank**: Средний ранг метода.

### Ключевые результаты
| Метод          | Avg. NS (%) | Avg. Rank | Top 1 (датасетов) |  
|----------------|-------------|-----------|-------------------|  
| **SELA**       | **53.3**    | **4.8**   | **7**             |  
| AutoGluon      | 53.2        | 4.4       | 4                 |  
| Data Interpreter| 47.4        | 8.8       | 2                 |  

- **Победы**: SELA выиграла в **65–80%** датасетов против каждого базового метода.  
- **Влияние числа итераций**:  
  Увеличение rollouts с 1 до 20 → рост NS на **6.4%** (Рис. 4).  

---

##  Пример работы (Кейс-стади)

**Датасет**: GesturePhaseSegmentationProcessed (классификация фаз жестов).  
**Шаги SELA**:  
1. **Insight Proposer** генерирует:  
   - "Создать признаки на основе скорости и ускорения".  
2. **MCTS** выбирает путь:  
   - Feature Engineering → "Скорость/ускорение" → Model Training → SVM (RBF-ядро).  
3. **Experiment Executor** выполняет код → F1-score = **0.694**.  
4. **Backpropagation** обновляет веса узлов → путь становится приоритетным.

**Итог**: SELA превзошла AutoGluon на 2.1%.

---

##  Выводы
- **Преимущества SELA**:  
  - Комбинация креативности LLM и системности MCTS.  
  - Итеративный поиск с обратной связью → имитация экспертного анализа.  
- **Перспективы**:  
  - Применение в робототехнике, научных исследованиях.  
  - Улучшение интерпретируемости решений.  
- **Ограничения**:  
  - Высокие вычислительные затраты при 20+ rollouts.  
  - Зависимость от качества инсайтов LLM.

**SELA** задает новый стандарт для AutoML, демонстрируя превосходство гибридных агентов над традиционными методами.